<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Burguer Store - Card√°pio</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>
    <h1>üçî Burguer Store</h1>
    <button id="btn-carrinho">üõí Carrinho (<span id="contador">0</span>)</button>
  </header>

  <main>
    <section class="categoria">
      <h2>üçî Lanches</h2>
      <div class="grid">
        {% for item in produtos['Lanches'] %}
        <div class="card">
          {% if item.imagem %}
            <img src="{{ url_for('static', filename='imagens/' ~ item.imagem) }}" alt="{{ item.nome }}">
          {% endif %}
          <h3>{{ item.nome }}</h3>
          {% if item.descricao %}<p class="desc">{{ item.descricao }}</p>{% endif %}
          <p class="preco">R$ {{ '%.2f'|format(item.preco) }}</p>

          <button class="btn-add"
                  data-nome="{{ item.nome }}"
                  data-preco="{{ '%.2f'|format(item.preco) }}">
            Adicionar
          </button>
        </div>
        {% endfor %}
      </div>
    </section>

    <section class="categoria">
      <h2>ü•§ Bebidas</h2>
      <div class="grid">
        {% for item in produtos['Bebidas'] %}
        <div class="card">
          {% if item.imagem %}
            <img src="{{ url_for('static', filename='imagens/' ~ item.imagem) }}" alt="{{ item.nome }}">
          {% endif %}
          <h3>{{ item.nome }}</h3>
          {% if item.descricao %}<p class="desc">{{ item.descricao }}</p>{% endif %}
          <p class="preco">R$ {{ '%.2f'|format(item.preco) }}</p>

          <button class="btn-add"
                  data-nome="{{ item.nome }}"
                  data-preco="{{ '%.2f'|format(item.preco) }}">
            Adicionar
          </button>
        </div>
        {% endfor %}
      </div>
    </section>
  </main>

  <!-- Modal do carrinho -->
  <div id="modal-carrinho" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true">
      <h2>üõçÔ∏è Seu Carrinho</h2>

      <ul id="itens-carrinho"></ul>

      <p><strong>Total:</strong> R$ <span id="total-carrinho">0.00</span></p>

      <div style="display:flex;gap:10px;flex-direction:column;">
        <button id="btn-enviar" class="modal-btn">üì± Confirmar e Enviar ao WhatsApp</button>
        <button id="btn-fechar" class="modal-btn-secondary">Fechar</button>
      </div>
    </div>
  </div>

  <script>
    // --- L√≥gica do carrinho (front-end) ---
    const carrinho = [];

    function parsePreco(precoStr) {
      return Number(String(precoStr).replace(',', '.'));
    }

    function adicionarCarrinho(nome, preco) {
      const p = parsePreco(preco);
      carrinho.push({ nome: String(nome), preco: p });
      document.getElementById('contador').textContent = carrinho.length;
    }

    function atualizarModal() {
      const lista = document.getElementById('itens-carrinho');
      const totalSpan = document.getElementById('total-carrinho');
      lista.innerHTML = '';
      let total = 0;
      carrinho.forEach((item, idx) => {
        total += item.preco;
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${item.nome}</span>
          <span style="float:right">R$ ${item.preco.toFixed(2)}</span>
          <button class="remover" data-idx="${idx}" style="display:block;margin-top:6px">Remover</button>
        `;
        lista.appendChild(li);
      });
      totalSpan.textContent = total.toFixed(2);

      // remover handlers
      document.querySelectorAll('#itens-carrinho .remover').forEach(btn => {
        btn.addEventListener('click', () => {
          const i = Number(btn.dataset.idx);
          if (!Number.isNaN(i)) { carrinho.splice(i,1); document.getElementById('contador').textContent = carrinho.length; atualizarModal(); }
        });
      });
    }

    function abrirModal() {
      document.getElementById('modal-carrinho').classList.add('ativo');
      document.getElementById('modal-carrinho').setAttribute('aria-hidden','false');
      atualizarModal();
    }
    function fecharModal() {
      document.getElementById('modal-carrinho').classList.remove('ativo');
      document.getElementById('modal-carrinho').setAttribute('aria-hidden','true');
    }

    function enviarWhatsApp() {
      if (carrinho.length === 0) { alert('Seu carrinho est√° vazio!'); return; }
      let mensagem = 'üçî *Pedido Burguer Store*%0A%0A';
      let total = 0;
      carrinho.forEach(item => { mensagem += `‚Ä¢ ${encodeURIComponent(item.nome)} - R$ ${item.preco.toFixed(2)}%0A`; total += item.preco; });
      mensagem += `%0ATotal: R$ ${total.toFixed(2)}%0A%0Aüìç Envie seu endere√ßo:`;
      const numero = '5511999999999'; // substitua pelo n√∫mero real
      const url = `https://wa.me/${numero}?text=${mensagem}`;
      window.open(url, '_blank');
    }

    // quando DOM pronto: ligar bot√µes
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.btn-add').forEach(btn => {
        btn.addEventListener('click', () => {
          adicionarCarrinho(btn.dataset.nome, btn.dataset.preco);
        });
      });
      document.getElementById('btn-carrinho').addEventListener('click', abrirModal);
      document.getElementById('btn-fechar').addEventListener('click', fecharModal);
      document.getElementById('btn-enviar').addEventListener('click', enviarWhatsApp);

      // fechar modal ao clicar fora
      document.getElementById('modal-carrinho').addEventListener('click', (e) => {
        if (e.target.id === 'modal-carrinho') fecharModal();
      });
    });
  </script>
</body>
</html>
